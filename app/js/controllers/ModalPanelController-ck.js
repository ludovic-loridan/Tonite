/*
    ===========================
    = ModalPanelController.js =
    ===========================

    Manage the modal panel.
    Allow to open/close the modal panel.
    Give life/behaviour to the buttons inside it.

    ModalPanelController is a Controller of Controllers : it takes two controllers in order to
    display their views side by side.

    Author : Ludovic Loridan

*/(function(){var e="ModalPanelController",t=["primaryController","secondaryController","view","CSSClass","isOpened","secondaryIsOpened","userWantsSecondaryOpened","view","HTMLOverlay","HTMLPrimary","HTMLSecondary","HTMLPrimaryContent","HTMLSecondaryContent","HTMLFoldButton","HTMLCloseButton","HTMLCloseButtonTop","HTMLTabs","HTMLPrimaryTab","HTMLSecondaryTab","isSplit"],n={openPrimary:function(){this.isOpened=!0},closePrimary:function(){this.isOpened=!1},setIsOpened:function(e){isOpened=e;this.updatePrimaryModalState()},updatePrimaryModalState:function(){this.isOpened?this.displayModal():this.unshowModal()},displayModal:function(){document.body.classList.add("modalDisplayed");var e=getThisCallingFunction(this,"showModal");setTimeout(e,20)},showModal:function(){document.body.classList.add("modalVisible")},unshowModal:function(){document.body.classList.remove("modalVisible")},undisplayModal:function(){document.body.classList.remove("modalDisplayed")},modalHasTransited:function(e){e.propertyName==="right"&&this.modalRightHasTransited(e)},modalRightHasTransited:function(e){if(this.isOpened===null){console.log("Null met");console.log(this===ModalPanelController.getController());console.log(this.isOpened)}this.isOpened||this.undisplayModal()},openSecondary:function(){this.secondaryIsOpened=!0;this.userWantsSecondaryOpened=!0},closeSecondary:function(){this.secondaryIsOpened=!1;this.userWantsSecondaryOpened=!1},switchToSecondaryTab:function(){if(ModalPanelController.isTabbed()){this.secondaryIsOpened=!0;this.userWantsSecondaryOpened=!0}},switchToPrimaryTab:function(){ModalPanelController.isTabbed()&&(this.secondaryIsOpened=!1)},toggleSecondary:function(){this.secondaryIsOpened?this.closeSecondary():this.openSecondary()},setSecondaryIsOpened:function(e){secondaryIsOpened=e;this.updateSecondaryModalState()},updateSecondaryModalState:function(){if(this.secondaryIsOpened){console.log("is closed");this.HTMLSecondary.classList.remove("closed")}else this.HTMLSecondary.classList.add("closed")},setPrimaryController:function(e){if(this.primaryController!==e){primaryController=e;this.updatePrimaryView()}},setSecondaryController:function(e){if(this.secondaryController!==e){secondaryController=e;this.updateSecondaryView()}},updatePrimaryView:function(){this.emptyPrimaryContent();this.HTMLPrimaryContent.appendChild(this.primaryController.view);this.updatePrimaryTab()},updateSecondaryView:function(){this.emptySecondaryContent();this.HTMLSecondaryContent.appendChild(this.secondaryController.view);this.updateSecondaryTab()},emptyPrimaryContent:function(){this.HTMLPrimaryContent.removeAllChildren()},emptySecondaryContent:function(){this.HTMLSecondaryContent.removeAllChildren()},updatePrimaryTab:function(){var e=hasAValueOr(this.primaryController.title,"Primary");this.HTMLPrimaryTab.setText(e)},updateSecondaryTab:function(){var e=hasAValueOr(this.secondaryController.title,"Secondary");this.HTMLSecondaryTab.setText(e)},setCSSClass:function(e){this.HTMLPrimary.classList.remove(this.CSSClass);this.HTMLPrimary.classList.add(e);CSSClass=e},updateView:function(){this.updatePrimaryView();this.updateSecondaryView();this.updatePrimaryModalState();this.updateSecondaryModalState()},installEventListeners:function(){this.installTransitionEventListener();this.installButtonsListeners();this.installSplitStatusCheckingListeners()},installTransitionEventListener:function(){var e=getThisCallingFunction(this,"modalHasTransited");this.HTMLPrimary.addTransitionCallback(e)},installButtonsListeners:function(){this.HTMLFoldButton.addEventListener("click",getThisCallingFunction(this,"toggleSecondary"));var e=getThisCallingFunction(this,"closePrimary");this.HTMLCloseButton.addEventListener("click",e);this.HTMLCloseButtonTop.addEventListener("click",e);this.HTMLOverlay.addEventListener("click",e);var t=getThisCallingFunction(this,"switchToPrimaryTab"),n=getThisCallingFunction(this,"switchToSecondaryTab");this.HTMLPrimaryTab.addEventListener("click",t);this.HTMLSecondaryTab.addEventListener("click",n)},installSplitStatusCheckingListeners:function(){var e=getThisCallingFunction(this,"checkSplitStatusChange");window.addEventListener("resize",e)},updateSplitStatus:function(){this.isSplit=ModalPanelController.isSplit()},checkSplitStatusChange:function(){var e=this.isSplit;this.updateSplitStatus();var t=this.isSplit;e!==t&&this.splitStatusHasChanged()},splitStatusHasChanged:function(){this.isSplit?this.secondaryIsOpened=this.userWantsSecondaryOpened:this.secondaryIsOpened=!1},matchWithView:function(){this.view=document.getElementById("modalPanel");this.HTMLOverlay=document.getElementById("overlay");this.HTMLPrimary=document.getElementById("primaryModal");this.HTMLSecondary=document.getElementById("secondaryModal");this.HTMLPrimaryContent=this.view.querySelector("#primaryModal > .content");this.HTMLSecondaryContent=this.HTMLSecondary.querySelector(".content");this.HTMLFoldButton=this.HTMLPrimary.querySelector(".foldButton");this.HTMLCloseButton=this.view.querySelector("#primaryModal > .closeButton");this.HTMLCloseButtonTop=this.HTMLPrimary.querySelector(".topModal > .closeButton");this.HTMLTabs=document.getElementById("tabs");this.HTMLPrimaryTab=this.HTMLTabs.querySelector(".tabButton:nth-child(1)");this.HTMLSecondaryTab=this.HTMLTabs.querySelector(".tabButton:nth-child(2)");this.view.controller=this;return this.view},assertThatMachingIsGood:function(){if(!this.matchingIsGood())throw"Error in matching modal panels"},matchingIsGood:function(){return this.HTMLOverlay instanceof Node&&this.HTMLOverlay instanceof Node&&this.HTMLPrimary instanceof Node&&this.HTMLSecondary instanceof Node&&this.HTMLPrimaryContent instanceof Node&&this.HTMLSecondaryContent instanceof Node&&this.HTMLFoldButton instanceof Node&&this.HTMLCloseButton instanceof Node&&this.HTMLTabs instanceof Node&&this.HTMLPrimaryTab instanceof Node&&this.HTMLSecondaryTab instanceof Node},initialState:function(){this.isOpened=!1;this.secondaryIsOpened=!0}},r=function(){if(ModalPanelController.hasBeenInstanced())throw"An instance of ModalPanel has ever been instanced";this.matchWithView();this.installEventListeners();this.initialState();this.checkSplitStatusChange();ModalPanelController.singleton=this},i={getView:function(){return ModalPanelController.getController().view},getController:function(){return ModalPanelController.hasBeenInstanced()?ModalPanelController.singleton:new ModalPanelController},hasBeenInstanced:function(){return ModalPanelController.singleton!==null},isTabbed:function(){return document.body.offsetWidth<=660},isSplit:function(){return!ModalPanelController.isTabbed()}},s={singleton:null};Class.create(e,t,n,r,i,s)})();